---
title: "Mortgage Interest Rates"
subtitle: "Skandia Bank"
author: "Roy Francis"
date: last-modified
date-format: "DD-MMM-YYYY"
title-block-banner: true
format: 
  html:
    page-layout: full
    self-contained: true
    theme: flatly
---

```{r,include=FALSE}
library(lubridate)
library(readxl)
library(highcharter)
library(ggplot2)
library(tidyr)
library(dplyr)

key_a <- c(y0.5 = "6 months", y1 = "1 year", y2 = "2 years", y3 = "3 years", y5 = "5 years")
key_b <- c(y0.5 = 1, y1 = 2, y2 = 3, y3 = 4, y5 = 5)

s <- readxl::read_xlsx("skandia-interest.xlsx") %>%
      tidyr::pivot_longer(`y0.5`:`y5`, names_to = "period", values_to = "value") %>%
      mutate(label=recode(period, !!!key_a)) %>%
      mutate(ord=recode(period, !!!key_b)) %>%
      mutate(date=lubridate::as_date(paste0("01-",month,"-",year),format="%d-%b-%Y")) %>%
      arrange(ord,date)

s %>%
  group_by(ord,date) %>%
  summarise()

s1 <- s %>%
  dplyr::select(-period,-label,-date) %>%
  dplyr::group_by(year,month) %>%
  tidyr::nest() %>%
  mutate(slope_5=purrr::map(data,~coef(lm(value~ord, data=.x))[["ord"]])) %>%
  select(-data) %>%
  unnest(cols=slope_5) %>%
  mutate(date=lubridate::as_date(paste0("01-",month,"-",year),format="%d-%b-%Y")) %>%
  ungroup()

s2 <- s %>%
  filter(period!="y5") %>%
  dplyr::select(-period,-label,-date) %>%
  dplyr::group_by(year,month) %>%
  tidyr::nest() %>%
  mutate(slope_3=purrr::map(data, ~coef(lm(value~ord, data=.x))[["ord"]])) %>%
  select(-data) %>%
  unnest(cols=slope_3) %>%
  mutate(date=lubridate::as_date(paste0("01-",month,"-",year),format="%d-%b-%Y")) %>%
  ungroup()

s3 <- s %>%
  filter(period!="y5" & period!="y3") %>%
  dplyr::select(-period,-label,-date) %>%
  dplyr::group_by(year,month) %>%
  tidyr::nest() %>%
  mutate(slope_2=purrr::map(data, ~coef(lm(value~ord, data=.x))[["ord"]])) %>%
  select(-data) %>%
  unnest(cols=slope_2) %>%
  mutate(date=lubridate::as_date(paste0("01-",month,"-",year),format="%d-%b-%Y")) %>%
  ungroup()

s4 <- s1 %>%
  inner_join(select(s2,date,slope_3),by="date") %>%
  inner_join(select(s3,date,slope_2),by="date") %>%
  tidyr::pivot_longer(c(slope_5,slope_3,slope_2), names_to = "period", values_to = "value") %>%
  arrange(date)
```

```{r,echo=FALSE}
hchart(s,"line",hcaes(x=date,y=value,group=label)) %>%
  hc_xAxis(title=list(text="Date"),crosshair=TRUE) %>%
  hc_yAxis(title=list(text="Interest rate %"),crosshair=TRUE) %>%
  hc_chart(zoomType="xy") %>%
  hc_plotOptions(scatter=list(marker=list(radius=3),opacity=0.8)) %>%
  hc_legend(enabled=TRUE,verticalAlign="top",align="right") %>%
  hc_size(height=500) %>%
  #hc_title(text=title,align="left") %>%
  hc_exporting(buttons=list(contextButton=list(enabled=TRUE)))
```

Skandia interest rates for home loan over time. Different colours denotes different periods of fixed rates (6 months, 1 year, 2 years, 3 years, 5 years).

```{r,echo=FALSE}
hchart(s4,"line",hcaes(x=date,y=value,group=period)) %>%
  hc_xAxis(title=list(text="Date"),crosshair=TRUE) %>%
  hc_yAxis(title=list(text="Slope"),crosshair=TRUE) %>%
  hc_chart(zoomType="xy") %>%
  hc_plotOptions(scatter=list(marker=list(radius=3),opacity=0.8)) %>%
  hc_legend(enabled=TRUE,verticalAlign="top",align="right") %>%
  hc_size(height=400) %>%
  #hc_title(text=title,align="left") %>%
  hc_exporting(buttons=list(contextButton=list(enabled=TRUE)))
```

Slope of fixed interest rates per month. Slope is computed over 0.5 - 2 years, 0.5 - 3 years or 0.5 - 5 years.

